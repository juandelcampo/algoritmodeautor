<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algoritmo de Autor</title>
    <link rel="icon" type="image/png" href="icons8-youtube-32.png">
    <style>
        /* --- ESTILOS GENERALES --- */
        html { scroll-behavior: smooth; scroll-padding-top: 90px; }
        :root { --bg-color: #0f0f0f; --text-color: #e5e5e5; --netflix-red: #E50914; }
        body { margin: 0; background-color: var(--bg-color); color: var(--text-color); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; overflow-x: hidden; }

        /* --- HEADER Y NAVEGACI√ìN --- */
        header { padding: 15px 4%; position: fixed; top: 0; width: 100%; background: linear-gradient(to bottom, rgba(15,15,15,0.9) 0%, rgba(15,15,15,0) 100%); transition: background-color 0.4s ease; z-index: 1000; box-sizing: border-box; display: flex; align-items: center; gap: 30px; }
        header.scrolled { background-color: rgba(15, 15, 15, 0.98); box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .logo { color: var(--netflix-red); font-size: 2.2rem; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); text-decoration: none; flex-shrink: 0; }
        .main-nav { display: flex; align-items: center; gap: 15px; width: 120%; overflow: visible; }

        /* --- BARRA DE B√öSQUEDA --- */
        .search-container { margin-left: auto; display: flex; align-items: center; }
        .search-input { background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 255, 255, 0.2); color: white; padding: 8px 15px; border-radius: 20px; outline: none; font-size: 0.9rem; transition: all 0.3s ease; width: 130px; }
        .search-input:focus { background: rgba(0, 0, 0, 0.8); border-color: var(--netflix-red); width: 150px; }
        .search-input::placeholder { color: rgba(255, 255, 255, 0.5); }

        /* --- DROPDOWNS --- */
        .dropdown { position: relative; display: inline-block; flex-shrink: 0; }
        .dropbtn { background: rgba(255, 255, 255, 0.05); color: white; border: 1px solid rgba(255, 255, 255, 0.2); padding: 10px 18px; border-radius: 8px; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; }
        .dropdown:hover .dropbtn { background: rgba(255, 255, 255, 0.15); }
        .dropdown-content { display: none; position: absolute; background-color: rgba(20, 20, 20, 0.95); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); min-width: 160px; box-shadow: 0px 15px 30px rgba(0,0,0,0.7); border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1); top: 110%; left: 0; padding: 10px 0; z-index: 1001; }
        .dropdown:hover .dropdown-content { display: block; animation: fadeIn 0.2s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .dropdown-content a { color: rgba(255, 255, 255, 0.7); padding: 10px 20px; text-decoration: none; display: block; font-size: 0.9rem; transition: all 0.2s; }
        .dropdown-content a:hover { background-color: rgba(255, 255, 255, 0.1); color: #fff; padding-left: 25px; }

        /* --- CHIPS DE G√âNEROS --- */
        .genres-menu { display: flex; gap: 12px; overflow-x: auto; scrollbar-width: none; -ms-overflow-style: none; padding: 5px 0; }
        .genres-menu::-webkit-scrollbar { display: none; }
        .genre-chip { color: rgba(255, 255, 255, 0.85); text-decoration: none; font-size: 0.9rem; font-weight: 500; padding: 8px 18px; border-radius: 20px; background: rgba(255, 255, 255, 0.1); white-space: nowrap; border: 1px solid transparent; transition: all 0.3s ease; }
        .genre-chip:hover { background: #fff; color: #000; border-color: #fff; transform: scale(1.05); }

        /* --- SECCI√ìN HERO FULL BLEED --- */
        .hero-wrapper { position: relative; width: 100%; height: 85vh; min-height: 500px; overflow: hidden; background-color: #000; transition: opacity 0.3s ease; }
        .hero-carousel { display: flex; width: 100%; height: 100%; overflow-x: auto; overflow-y: hidden; scroll-behavior: smooth; scroll-snap-type: x mandatory; scrollbar-width: none; -ms-overflow-style: none; }
        .hero-carousel::-webkit-scrollbar { display: none; }
        .hero-slide { flex: 0 0 100%; height: 100%; position: relative; background-size: cover; background-position: center top; scroll-snap-align: start; display: flex; align-items: flex-end; padding-bottom: 8%; }
        .hero-slide::before { content: ''; position: absolute; inset: 0; background: linear-gradient(to right, rgba(15,15,15,0.95) 0%, rgba(15,15,15,0.4) 40%, transparent 80%), linear-gradient(to top, rgba(15,15,15,1) 0%, rgba(15,15,15,0.6) 20%, transparent 60%); z-index: 1; }
        .hero-content { position: relative; z-index: 2; display: flex; flex-direction: column; align-items: flex-start; text-align: left; width: 100%; max-width: 800px; padding: 0 4%; }
        .hero-title { font-size: 3.5rem; font-weight: 900; margin: 0 0 25px 0; line-height: 1.1; letter-spacing: -1px; text-shadow: 0 4px 15px rgba(0,0,0,0.8); color: #fff; }
        .play-btn { display: inline-flex; align-items: center; gap: 12px; background: #fff; color: #000; padding: 14px 35px; font-size: 1.1rem; font-weight: 700; border-radius: 4px; text-decoration: none; text-transform: uppercase; letter-spacing: 1px; transition: all 0.2s ease; border: none; cursor: pointer; }
        .play-btn:hover { background: rgba(255, 255, 255, 0.8); transform: scale(1.05); }
        .hero-btn { font-size: 4rem; width: 70px; }

        /* --- CONTENEDOR DE LISTAS --- */
        .main-content { padding-bottom: 50px; min-height: 50vh; position: relative; z-index: 10; margin-top: 30px; transition: padding-top 0.3s ease; }
        .row { margin-bottom: 40px; position: relative; }
        .row-title { font-size: 2rem; margin-bottom: 15px; padding: 0 4%; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: rgba(255, 255, 255, 0.9); display: flex; align-items: center; transition: all 0.3s ease; }
        .row-title::before { content: ''; display: inline-block; width: 4px; height: 18px; background-color: var(--netflix-red); margin-right: 12px; border-radius: 2px; }
        .row-posters { display: flex; overflow-y: visible; overflow-x: auto; padding: 20px 4%; gap: 15px; scroll-behavior: smooth; scroll-snap-type: x mandatory; scrollbar-width: none; -ms-overflow-style: none; transition: all 0.3s ease; }
        .row-posters::-webkit-scrollbar { display: none; }
        .scroll-btn { position: absolute; top: 50%; transform: translateY(-50%); width: 50px; height: 100%; background: rgba(15,15,15,0.6); border: none; color: #fff; font-size: 3rem; cursor: pointer; z-index: 200; opacity: 0; transition: opacity 0.3s ease, background 0.3s ease; }
        .row:hover .scroll-btn, .hero-wrapper:hover .scroll-btn { opacity: 0.8; }
        .scroll-btn:hover { background: rgba(15,15,15,0.9); opacity: 1 !important; }
        .scroll-btn.left { left: 0; border-top-right-radius: 8px; border-bottom-right-radius: 8px; }
        .scroll-btn.right { right: 0; border-top-left-radius: 8px; border-bottom-left-radius: 8px; }

        /* --- TARJETAS HORIZONTALES (Mejor para YouTube) --- */
        .movie-card-wrapper { flex: 0 0 auto; width: 280px; text-decoration: none; cursor: pointer; transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), z-index 0s linear 0.1s; position: relative; z-index: 1; scroll-snap-align: start; }
        .movie-card-wrapper:hover { transform: scale(1.15); z-index: 100; transition-delay: 0s; }
        .poster-container { width: 100%; aspect-ratio: 16/9; position: relative; border-radius: 8px; overflow: hidden; background-color: #222; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: box-shadow 0.3s ease; }
        .movie-card-wrapper:hover .poster-container { box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8); }
        .thumbnail { width: 100%; height: 100%; object-fit: cover; }
        
        .movie-info { padding: 12px 4px 0 4px; color: #ffffff; text-align: center; font-size: 1.1rem; font-weight: 600; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; opacity: 0.8; transition: opacity 0.3s ease; }
        .movie-card-wrapper:hover .movie-info { opacity: 1; color: var(--netflix-red); }
        .duration-overlay { position: absolute; bottom: 8px; right: 8px; background: rgba(0, 0, 0, 0.8); color: #fff; padding: 2px 6px; font-size: 0.75rem; border-radius: 4px; font-weight: 600; pointer-events: none; }

        /* --- ESTADOS DE B√öSQUEDA (MODO GRILLA) --- */
        body.is-searching #hero-wrapper { display: none !important; }
        body.is-searching .main-content { padding-top: 100px; min-height: 100vh; }
        body.is-searching .row-title { display: none; } /* Oculta t√≠tulos de filas para hacer una grilla continua */
        body.is-searching .row { margin-bottom: 0; }
        body.is-searching .row-posters { flex-wrap: wrap; justify-content: flex-start; overflow-x: hidden; padding: 0 4% 20px 4%; gap: 20px; }
        body.is-searching .scroll-btn { display: none !important; }
        body.is-searching .movie-card-wrapper { margin-bottom: 25px; }

        #search-results-title { display: none; font-size: 2.2rem; margin-bottom: 30px; padding: 0 4%; font-weight: 700; color: #fff; }
        body.is-searching #search-results-title { display: block; }

        /* --- MODAL DE DETALLES DE PEL√çCULA --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        
        .modal-content {
            background: #141414;
            width: 90%; max-width: 900px; max-height: 90vh;
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            position: relative;
            padding: 40px; box-sizing: border-box;
            transform: translateY(50px);
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .modal-overlay.active .modal-content { transform: translateY(0); }

        #modal-details {
            display: flex; flex-direction: row; gap: 30px; width: 100%;
        }

        /* --- REPRODUCTOR DE VIDEO --- */
        #video-container {
            display: none;
            width: 100%;
            aspect-ratio: 16 / 9;
            border-radius: 8px;
            overflow: hidden;
            background: #000;
        }

        .modal-close {
            position: absolute; top: 20px; right: 25px;
            background: rgba(255,255,255,0.1); border: none; color: white;
            width: 40px; height: 40px; border-radius: 50%;
            font-size: 1.5rem; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: background 0.2s;
            z-index: 10;
        }
        .modal-close:hover { background: rgba(255,255,255,0.2); }

        .modal-poster { width: 35%; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); object-fit: cover; aspect-ratio: 2/3; }
        
        .modal-info-text { width: 65%; display: flex; flex-direction: column; }
        .modal-title { font-size: 2.5rem; margin: 0 0 10px 0; line-height: 1.1; }
        
        .modal-meta { display: flex; gap: 15px; color: #a3a3a3; font-size: 0.9rem; margin-bottom: 20px; align-items: center; flex-wrap: wrap;}
        .imdb-badge { background: #f5c518; color: black; font-weight: 900; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem;}
        
        .modal-plot { font-size: 1.1rem; line-height: 1.6; color: #d2d2d2; margin-bottom: 25px; }
        .modal-cast { color: #888; font-size: 0.95rem; margin-bottom: 8px; line-height: 1.4; }
        .modal-cast span { color: #fff; }

        .modal-play-btn { margin-top: auto; display: inline-flex; justify-content: center; margin-top: 30px;}

        /* Loading local para el modal */
        .modal-loading { position: absolute; inset: 0; background: #141414; display: flex; justify-content: center; align-items: center; z-index: 20; border-radius: 12px; }
        .loading-global { display: flex; justify-content: center; align-items: center; height: 60vh; font-size: 1.5rem; color: #888; }
        .spinner { border: 4px solid rgba(255, 255, 255, 0.1); border-left-color: var(--netflix-red); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-right: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* =========================================
           MEDIA QUERIES - OPTIMIZACI√ìN M√ìVIL 
           ========================================= */
        @media (max-width: 900px) {
            header { display: none; }
            html { scroll-padding-top: 0; } 
            .scroll-btn { display: none !important; }
            .row-posters { padding-bottom: 10px; }
            .hero-wrapper { height: 70vh; min-height: 450px; }
            .hero-slide { align-items: flex-end; padding-bottom: 15%; }
            .hero-content { max-width: 100%; }
            .hero-title { font-size: 2.2rem; margin-bottom: 15px; }
            .play-btn { padding: 10px 25px; font-size: 0.9rem; }
            .row-title { font-size: 3rem; }
            .main-content { margin-top: 0; } 
            
            .modal-content { padding: 25px 20px; }
            #modal-details { flex-direction: column; gap: 20px; }
            .modal-poster { width: 50%; margin: 0 auto; aspect-ratio: auto;}
            .modal-info-text { width: 100%; }
            .modal-title { font-size: 1.8rem; }
            .modal-close { top: 10px; right: 10px; background: rgba(0,0,0,0.5); }
        }
    </style>
</head>
<body>

    <header id="main-header">
        <nav id="main-nav" class="main-nav">
            <div id="genres-menu" class="genres-menu"></div>
            <div class="dropdown">
                <button class="dropbtn">Directores <svg width="12" height="12" fill="currentColor" viewBox="0 0 16 16"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/></svg></button>
                <div class="dropdown-content" id="directors-menu"></div>
            </div>
            <div class="dropdown">
                <button class="dropbtn">Series <svg width="12" height="12" fill="currentColor" viewBox="0 0 16 16"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/></svg></button>
                <div class="dropdown-content" id="series-menu"></div>
            </div>
            <div class="search-container">
                <input type="text" id="search-bar" class="search-input" placeholder="Buscar t√≠tulo...">
            </div>
        </nav>
    </header>

    <div class="hero-wrapper" id="hero-wrapper" style="display: none;">
        <button class="scroll-btn left hero-btn" onclick="scrollHero('left')">‚Äπ</button>
        <div id="hero-carousel" class="hero-carousel"></div>
        <button class="scroll-btn right hero-btn" onclick="scrollHero('right')">‚Ä∫</button>
    </div>

    <div class="main-content" id="app">
        <h2 id="search-results-title"></h2>
        <div class="loading-global" id="loading-global"><div class="spinner"></div> Cargando cartelera...</div>
    </div>

    <div id="movie-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">‚úï</button>
            <div id="modal-loader" class="modal-loading"><div class="spinner"></div></div>
            
            <div id="video-container"></div>

            <div id="modal-details">
                <img id="modal-poster" class="modal-poster" src="" alt="Poster">
                
                <div class="modal-info-text">
                    <h2 id="modal-title" class="modal-title">T√≠tulo de la pel√≠cula</h2>
                    <div class="modal-meta">
                        <span id="modal-year">2023</span>
                        <span id="modal-runtime">120 min</span>
                        <span class="imdb-badge">IMDb <span id="modal-rating">N/A</span></span>
                    </div>
                    <p id="modal-plot" class="modal-plot">Cargando sinopsis...</p>
                    <div class="modal-cast">Director: <span id="modal-director">-</span></div>
                    <div class="modal-cast">Elenco: <span id="modal-actors">-</span></div>
                    <div class="modal-cast">G√©nero: <span id="modal-genre-full" style="color: #fff;">-</span></div>
                    <div class="modal-cast">Pa√≠s: <span id="modal-country" style="color: #fff;">-</span></div>
                    
                    <button id="modal-play" class="play-btn modal-play-btn" onclick="playVideo()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                        Reproducir aqu√≠
                    </button>
                </div>
            </div>
        </div>
    </div>

   <script>
        const API_KEY = 'AIzaSyDuK3KF3GCPU_IHzHUOVpWHNqqBN-7lVPM'; 
        const OMDB_API_KEY = 'dd75c1c5'; 
        const MAX_VIDEOS_PER_ROW = 200; 
        const HERO_PLAYLIST_ID = "PLV7ZM4nm6CtLwkaoAb6_4SxpW9Xn6cRcM"; 

        let currentVideoId = "";

        const categories = [
            { playlistId: "PLV7ZM4nm6CtKLpBKx3ZWIAdGHnNF6w8SS", title: "Destacadas", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtLez0TwVAwv-0ZTF9vZt6sM", title: "Drama", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtJNiGHg3OziNp7QnB7J6QOm", title: "Comedia", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtJki16toQetCi51p-CJ04Rt", title: "Acci√≥n", type: "genre" },              
            { playlistId: "PLV7ZM4nm6CtLywqlDY4bM94kFPIJr4ALz", title: "B√©lico", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtKndLGdyUOwCni78HiwFIsP", title: "Ciencia Ficci√≥n", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtJdz2iKDuiRhElws8Gy-MLf", title: "Misterio", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtJZgWKrm3b-N5IlF6OeP7hL", title: "Western", type: "genre" },          
            { playlistId: "PLV7ZM4nm6CtJMZcL-Nrmoqoobe6pztsv9", title: "Terror", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtI4dJNi59gYpi5p1aSeBwQ0", title: "Animaci√≥n", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtLTxKcOziHo-kueG1EDlLZ6", title: "Documental", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtJhkRgy6oI_09l7J3zuhD0s", title: "Experimental", type: "genre" },
            
            { playlistId: "PLV7ZM4nm6CtJMglVvjnQcfR48f9jY8ioL", title: "Mariano Llin√°s", type: "director"},
            { playlistId: "PLV7ZM4nm6CtLIIr_krlvjrL6cXt4JPViO", title: "Ra√∫l Perrone", type: "director"},
            { playlistId: "PLV7ZM4nm6CtLuDAhLYWt9SIBj968Erm1l", title: "Leonardo Favio", type: "director"},
            { playlistId: "PLV7ZM4nm6CtKG54-9aJYbW-N5G76oglSE", title: "Andrei Tarkovsky", type: "director"},
            { playlistId: "PLV7ZM4nm6CtIANqEvGy04Y6ueTlo3PXk1", title: "Werner Herzog", type: "director"},
            { playlistId: "PLV7ZM4nm6CtIwn8O37pT6RVnSfqocLoD1", title: "Ingmar Bergman", type: "director"},
            
            { playlistId: "PLVAh-MgDVqvDUEq6qDXqORBioE4Yhol_z", title: "Fen√≥meno: The Backrooms", type: "series"}
        ];

        const appContainer = document.getElementById('app');
        const directorsMenu = document.getElementById('directors-menu');
        const seriesMenu = document.getElementById('series-menu');
        const genresMenu = document.getElementById('genres-menu');

        function generateSlug(text) {
            return text.toString().toLowerCase().replace(/\s+/g, '-').replace(/[^\w\-]+/g, '').replace(/\-\-+/g, '-').replace(/^-+/, '').replace(/-+$/, '');
        }

        function cleanTitle(title) {
            // Diccionario de excepciones: LA CLAVE DEBE ESTAR TODA EN MIN√öSCULAS para que coincida.
            const excepciones = {
                "el viaja al pasado y cambia el futuro (querida voy a comprar cigarros y vuelvo) 4k pel√≠ argentina": "Querida, voy a comprar cigarrillos y vuelvo",
                "la pel√≠cula argentina que predice el futuro / fase 7 [ pel√≠cula completa] con yayo": "Fase 7",
                "david lynch's - hotel room (1993) [subtitulado al espa√±ol]": "Hotel Room", 
                "alfred hitchcock | the man who knew too much (1934) crime, mystery, thriller | movie, subtitles": "The Man Who Knew Too Much",
                'üìΩÔ∏è"m - eine stadt sucht einen m√∂rder".üé•fritz lang.1931/restored version/hd/deutsche-english-espa√±olüé¶': "M - Eine Stadt sucht einen M√∂rder",


            };

            const tituloNormalizado = title.toLowerCase().trim();
            if (excepciones[tituloNormalizado]) { return excepciones[tituloNormalizado]; }
           
            let t = title;
            const titleLower = t.toLowerCase();
            const isSeries = titleLower.includes('backrooms') || titleLower.includes('la flor');

            if (!isSeries) {
                t = t.replace(/\(.*?\)/g, '').replace(/\[.*?\]/g, '');
                t = t.replace(/^(19|20)\d{2}\s*[-|/]+\s*/, '');
                t = t.replace(/\s+(19|20)\d{2}.*$/i, '');
            }

            const directores = [
                'Werner Herzog', 'Herzog', 'Andrei Tarkovsky', 'Tarkovsky', 'Ingmar Bergman', 'Bergman', 
                'Leonardo Favio', 'Favio', 'Mariano Llin√°s', 'Llin√°s', 'Ra√∫l Perrone', 'Perrone'
            ];
            
            directores.forEach(d => {
                const regex = new RegExp('^' + d + '\\s*[-:,|/]*\\s*', 'i');
                t = t.replace(regex, '');
            });

            if (!isSeries) {
                if (t.includes(' - ')) t = t.split(' - ')[0];
                if (t.includes(' | ')) t = t.split(' | ')[0];
                if (t.includes(' / ')) t = t.split(' / ')[0];
                if (t.includes(' // ')) t = t.split(' // ')[0];
                if (t.includes(' ‚Ä¢ ')) t = t.split(' ‚Ä¢ ')[0];
                if (t.includes(' ‚Äß ')) t = t.split(' ‚Äß ')[0];
                if (t.includes('/')) t = t.split('/')[0];
                if (t.includes('„Ää')) t = t.split('„Ää')[0];
            }

            const basura = [ 
                'pelicula completa', 'pel√≠cula completa', 'subtitulada', 'subtitulado', 'subt√≠tulos', 'Subtitulos','subtitle', 
                'Brian De Palma', 'Documentary', 'criterion', 'Length', 'Watch', 'comedy', 'drama',
                '8KR REMASTER', '480p', '720p', '1080p', '4k', 'hd', 'hq', 'eng', 'dub',
                'cine', 'argentino', 'full', 'movie', 'espa√±ol', 'espanol', 'latino', 'audio', 'Pel√≠cula', '|1974',
                'oficial', 'trailer', 'cortometraje', 'documental',
                'rip', 'x264', 'x265', 'cpg', 'mkv', 'mp4', 'Blu-ray','„Äê',  'avi', 'bluray', 'persian', '‚ñ∂','brrip', 'webrip', 'dvdrip', 'hdtv', 'hevc', 'aac' 
            ];
            
            basura.forEach(palabra => { t = t.replace(new RegExp('\\b' + palabra + '\\b', 'gi'), ''); });

            const basuraExtra = ['Ra√∫l Perrone', 'Gory Splatter Fest of a Film', '- Uk Ep 1-3', '35Mm Scan', "Peter Jackson's", '. This Is the - Japanese Paganistic Film From', 'Jorge Nisco', 'Dir. Kim Ki-young', 'Remaster', '. John Carpenter', "de - en", "Alemania Occidental",
                                 ".de - en, ", "by Nikos Nikolaidis ", "Fernando Ayala", "Alejandro Agresti", "N√©stor Montalbano", "Fhd", 
                                 "John Cassavetes", "Daniel Barone", "Buster Keaton in ", "by Martin Scorsese", "Film with Subtitles", 
                                 "Leonardo Di Cesare", 'Youtube 360P', 'Juan Jos√© Jusid',  'Adolfo Aristarain', '-luis Bu√±uel', 
                                 'Juan Jos√© Campanella', 'Freudian Psychoanalyst Art Garfunkel Possesses Theresa Russell in Nicolas Roegs', 
                                 'Abbas Kiarostami Completa', 'D. Pettinari', '‚Äî1973‚Äî Wojciech Has„Äëmulti-ùó¶ùó®ùóï„Äë', 
                                 ' -Sergio Renan', 'Akira Kurosawa', 'with English','Gustavo Postiglione', 'Orson Welles‚Äô ', 
                                 'Is a Beautiful Nightmare', 'Santiago Carlos Oves', '. Koniec Cywilizacji', 'Is a Beautiful Nightmare','Film with Subtitles', 'Com√®dia', 'muy buena pelicula',  'Subtitulos en', 'Te Doy Mi Alma, Carl Jung,', 
                                 'Emilio Estevez, Samuel L Jackson, Tim Curry, William Shatner & Jon Lovitz', 'Jorge Nisco', 
                                 'by Sogo Ishii', '1 en la Isla de Berk ', 'Animated Cartoon', 'with English Subtitles', 'ÊòüÊ≤≥ÊàòÈòü1: Bd','Alejandro Jodorowsky', 
                                 '-Hollywood Action Adventure English','Pelicula argentina','Alejandro Chomski', 'Pablo Trapero', 'Il Postino: ','Esteban Sapir', 
                                 'Western', ', la', 'Alfred Hitchcock', 'Ingmar Bergman', 'de Mariano Llinas', '-- Sub.', '- Werner Herzog',
                                 'Matt Damon, Monica Bellucci In', 'Vera Fogwill', 'J. ≈†vankmajer','Israel Adri√°n Caetano', 
                                 'Burt Lancaster, Audrey Hepburn,','‚Ä¢ Rare Polish Dark Surrealism ‚Ä¢','‚Ä¢', '"', '~'];
            basuraExtra.forEach(frase => {
                t = t.replace(new RegExp(frase, 'gi'), '');
            });

            t = t.replace(/^[-|:,\.\s]+|[-|:,\.\s]+$/g, '');
            t = t.toLowerCase();
            
            const minWords = ['de', 'del', 'la', 'el', 'los', 'las', 'y', 'o', 'a', 'en', 'un', 'una', 'of', 'the', 'and', 'in', 'to', 'for', 'with', 'on', 'at', 'by'];
            t = t.split(/\s+/).map((word, index) => {
                if (!word) return '';
                const pureWord = word.replace(/[^a-z]/g, '');
                if (index === 0 || !minWords.includes(pureWord)) {
                    return word.replace(/[a-z√±√°√©√≠√≥√∫√º]/i, letter => letter.toUpperCase());
                } else {
                    return word; 
                }
            }).join(' ');

            return t.replace(/\s{2,}/g, ' ').trim();
        }

        async function translateToSpanish(text) {
            if (!text || text === "N/A") return text;
            try {
                const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=es&dt=t&q=${encodeURIComponent(text)}`;
                const response = await fetch(url);
                const data = await response.json();
                return data[0].map(item => item[0]).join('');
            } catch (error) { return text; }
        }

        async function translateToEnglish(text) {
            if (!text || text === "N/A") return text;
            try {
                const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=es&tl=en&dt=t&q=${encodeURIComponent(text)}`;
                const response = await fetch(url);
                const data = await response.json();
                return data[0].map(item => item[0]).join('');
            } catch (error) { return text; }
        }

        async function initApp() {
            if (!API_KEY || API_KEY === 'AAIzaSyDuK3KF3GCPU_IHzHUOVpWHNqqBN-7lVPM') {
                appContainer.innerHTML = '<h2 style="text-align:center; margin-top:50px; color: #E50914;">‚ö†Ô∏è Falta configurar la API Key.</h2>';
                return;
            }

            try {
                await loadHeroCarousel();
                document.getElementById('loading-global').style.display = 'none';

                const rowElements = categories.map(category => {
                    const sectionId = generateSlug(category.title);
                    const shortTitle = category.title.includes(':') ? category.title.split(':')[1].trim() : category.title;

                    const navLink = document.createElement('a');
                    navLink.href = `#${sectionId}`;
                    navLink.innerText = shortTitle;

                    if (category.type === "director") { directorsMenu.appendChild(navLink); } 
                    else if (category.type === "series") { seriesMenu.appendChild(navLink); } 
                    else { navLink.className = 'genre-chip'; genresMenu.appendChild(navLink); }

                    return createEmptyRowStructure(category.title, sectionId);
                });

                const fetchPromises = categories.map((category, index) => {
                    return loadRowData(category.playlistId, rowElements[index]);
                });

                await Promise.all(fetchPromises);

            } catch (error) {
                console.error("Error inicializando la app:", error);
            }
        }

        async function loadHeroCarousel() {
            const videos = await fetchPlaylistVideos(HERO_PLAYLIST_ID);
            const carousel = document.getElementById('hero-carousel');
            const wrapper = document.getElementById('hero-wrapper');

            if (!videos || videos.length === 0) return;
            const fragment = document.createDocumentFragment();

            videos.forEach(video => {
                const snippet = video.snippet;
                const originalTitle = snippet.title;
                const uiTitle = cleanTitle(originalTitle); 
                
                const videoId = snippet.resourceId.videoId;
                const imgUrl = snippet.thumbnails?.maxres?.url || snippet.thumbnails?.standard?.url || snippet.thumbnails?.high?.url || '';

                const slide = document.createElement('div');
                slide.className = 'hero-slide';
                slide.style.backgroundImage = `url('${imgUrl}')`;

                const content = document.createElement('div');
                content.className = 'hero-content';

                const titleEl = document.createElement('h1');
                titleEl.className = 'hero-title';
                titleEl.innerText = uiTitle; 

                const btn = document.createElement('button');
                btn.className = 'play-btn';
                btn.onclick = () => openMovieModal(videoId, uiTitle, imgUrl, video._duration, snippet.description);
                btn.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"/></svg> M√°s Info`;

                content.appendChild(titleEl);
                content.appendChild(btn);
                slide.appendChild(content);
                fragment.appendChild(slide);
            });

            carousel.appendChild(fragment);
            wrapper.style.display = 'block';
        }

        function scrollHero(direction) {
            const carousel = document.getElementById('hero-carousel');
            const scrollAmount = window.innerWidth;
            if (direction === 'left') { carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' }); } 
            else { carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' }); }
        }

        function createEmptyRowStructure(titleText, id) {
            const rowDiv = document.createElement('div');
            rowDiv.className = 'row';
            rowDiv.id = id; 

            const title = document.createElement('h2');
            title.className = 'row-title';
            title.innerText = titleText;

            const postersDiv = document.createElement('div');
            postersDiv.className = 'row-posters';

            const leftBtn = document.createElement('button');
            leftBtn.className = 'scroll-btn left';
            leftBtn.innerHTML = '‚Äπ';
            leftBtn.onclick = () => postersDiv.scrollBy({ left: -window.innerWidth * 0.8, behavior: 'smooth' });

            const rightBtn = document.createElement('button');
            rightBtn.className = 'scroll-btn right';
            rightBtn.innerHTML = '‚Ä∫';
            rightBtn.onclick = () => postersDiv.scrollBy({ left: window.innerWidth * 0.8, behavior: 'smooth' });

            rowDiv.appendChild(title);
            rowDiv.appendChild(leftBtn);
            rowDiv.appendChild(postersDiv);
            rowDiv.appendChild(rightBtn);
            appContainer.appendChild(rowDiv);

            return { rowDiv, postersDiv, leftBtn, rightBtn };
        }

        async function loadRowData(playlistId, elements) {
            const { rowDiv, postersDiv, leftBtn, rightBtn } = elements;
            const videos = await fetchPlaylistVideos(playlistId);

            if (videos.length === 0) { rowDiv.style.display = 'none'; return null; }
            if (videos.length < 5) { leftBtn.style.display = 'none'; rightBtn.style.display = 'none'; }

            const fragment = document.createDocumentFragment();
            videos.forEach(video => fragment.appendChild(createMovieCard(video)));
            postersDiv.appendChild(fragment);
        }

        async function fetchPlaylistVideos(playlistId) {
            try {
                let allItems = [];
                let nextPageToken = '';

                while (allItems.length < MAX_VIDEOS_PER_ROW) {
                    let url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${API_KEY}`;
                    if (nextPageToken) url += `&pageToken=${nextPageToken}`;
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (!data.items || data.items.length === 0) break;

                    const videoIds = data.items.map(it => it.snippet?.resourceId?.videoId).filter(Boolean);
                    if (videoIds.length > 0) {
                        const videosUrl = `https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${videoIds.join(',')}&key=${API_KEY}`;
                        const resp2 = await fetch(videosUrl);
                        const data2 = await resp2.json();
                        
                        const durations = {};
                        if (data2.items) {
                            data2.items.forEach(v => { durations[v.id] = v.contentDetails?.duration || ''; });
                        }

                        data.items.forEach(it => {
                            const vid = it.snippet?.resourceId?.videoId;
                            it._duration = (vid && durations[vid]) ? formatISO8601Duration(durations[vid]) : '';
                        });
                    }

                    allItems = allItems.concat(data.items);
                    nextPageToken = data.nextPageToken;
                    
                    if (!nextPageToken) break;
                }

                return allItems.slice(0, MAX_VIDEOS_PER_ROW);
            } catch (error) {
                console.error(`Error en playlist ${playlistId}:`, error);
                return [];
            }
        }

        function cleanYouTubeDescription(desc) {
            if (!desc) return "";
            let cleaned = desc.replace(/https?:\/\/[^\s]+/g, '').replace(/www\.[^\s]+/g, '');
            cleaned = cleaned.replace(/#\S+/g, '');
            cleaned = cleaned.replace(/\n+/g, ' ').replace(/\s{2,}/g, ' ').trim();
            if (cleaned.length > 250) {
                cleaned = cleaned.substring(0, 250);
                cleaned = cleaned.substring(0, Math.min(cleaned.length, cleaned.lastIndexOf(" "))) + "...";
            }
            return cleaned;
        }

       async function openMovieModal(videoId, cleanUiTitle, ytPosterUrl, duration, ytDescription) {
            const modal = document.getElementById('movie-modal');
            const loader = document.getElementById('modal-loader');
            
            currentVideoId = videoId;
            
            document.getElementById('video-container').innerHTML = '';
            document.getElementById('video-container').style.display = 'none';
            document.getElementById('modal-details').style.display = 'flex';

            document.getElementById('modal-title').innerText = cleanUiTitle; 
            document.getElementById('modal-poster').src = ytPosterUrl;
            document.getElementById('modal-plot').innerText = "Traduciendo sinopsis..."; 
            document.getElementById('modal-year').innerText = "YouTube";
            document.getElementById('modal-runtime').innerText = duration || "- min";
            document.getElementById('modal-genre-full').innerText = "Cargando..."; 
            document.getElementById('modal-country').innerText = "Cargando..."; 
            document.getElementById('modal-rating').innerText = "N/A";
            document.getElementById('modal-director').innerText = "Desconocido";
            document.getElementById('modal-actors').innerText = "Desconocido";

            modal.classList.add('active');
            loader.style.display = 'flex';
            document.body.style.overflow = 'hidden';

            const cleanYtDesc = cleanYouTubeDescription(ytDescription);

            try {
                let response = await fetch(`https://www.omdbapi.com/?t=${encodeURIComponent(cleanUiTitle)}&apikey=${OMDB_API_KEY}`);
                let data = await response.json();

                if (data.Response === "False") {
                    const searchResp = await fetch(`https://www.omdbapi.com/?s=${encodeURIComponent(cleanUiTitle)}&apikey=${OMDB_API_KEY}`);
                    const searchData = await searchResp.json();
                    if (searchData.Response === "True" && searchData.Search.length > 0) {
                        const imdbId = searchData.Search[0].imdbID;
                        response = await fetch(`https://www.omdbapi.com/?i=${imdbId}&apikey=${OMDB_API_KEY}`);
                        data = await response.json();
                    }
                }

                if (data.Response === "False") {
                    const englishTitle = await translateToEnglish(cleanUiTitle);
                    if (englishTitle.toLowerCase() !== cleanUiTitle.toLowerCase()) {
                        response = await fetch(`https://www.omdbapi.com/?t=${encodeURIComponent(englishTitle)}&apikey=${OMDB_API_KEY}`);
                        data = await response.json();
                        
                        if (data.Response === "False") {
                            const searchRespEn = await fetch(`https://www.omdbapi.com/?s=${encodeURIComponent(englishTitle)}&apikey=${OMDB_API_KEY}`);
                            const searchDataEn = await searchRespEn.json();
                            if (searchDataEn.Response === "True" && searchDataEn.Search.length > 0) {
                                const imdbIdEn = searchDataEn.Search[0].imdbID;
                                response = await fetch(`https://www.omdbapi.com/?i=${imdbIdEn}&apikey=${OMDB_API_KEY}`);
                                data = await response.json();
                            }
                        }
                    }
                }

                let textToTranslate = "Sin descripci√≥n disponible.";
                let genreToTranslate = "";
                let countryToTranslate = ""; 

                if (data.Response === "True") {
                    if(data.Poster !== "N/A") document.getElementById('modal-poster').src = data.Poster;
                    
                    document.getElementById('modal-year').innerText = data.Year;
                    document.getElementById('modal-runtime').innerText = data.Runtime;
                    document.getElementById('modal-rating').innerText = data.imdbRating;
                    document.getElementById('modal-director').innerText = data.Director;
                    document.getElementById('modal-actors').innerText = data.Actors;
                    
                    genreToTranslate = data.Genre !== "N/A" ? data.Genre : "";
                    countryToTranslate = data.Country !== "N/A" ? data.Country : "";

                    if (data.Plot && data.Plot !== "N/A") {
                        textToTranslate = data.Plot;
                    } else if (cleanYtDesc) {
                        textToTranslate = cleanYtDesc;
                    }
                } else if (cleanYtDesc) {
                    textToTranslate = cleanYtDesc;
                }

                const [finalPlot, finalGenre, finalCountry] = await Promise.all([
                    translateToSpanish(textToTranslate),
                    genreToTranslate ? translateToSpanish(genreToTranslate) : Promise.resolve(""),
                    countryToTranslate ? translateToSpanish(countryToTranslate) : Promise.resolve("")
                ]);

                document.getElementById('modal-plot').innerText = finalPlot;
                document.getElementById('modal-genre-full').innerText = finalGenre || "No disponible";
                document.getElementById('modal-country').innerText = finalCountry || "No disponible";

            } catch (error) {
                console.error("Error conectando con OMDb:", error);
                const fallbackPlot = await translateToSpanish(cleanYtDesc || "Sin descripci√≥n.");
                document.getElementById('modal-plot').innerText = fallbackPlot;
                document.getElementById('modal-genre-full').innerText = "No disponible";
                document.getElementById('modal-country').innerText = "No disponible";
            }
            
            loader.style.display = 'none';
        }

        function playVideo() {
            document.getElementById('modal-details').style.display = 'none';
            const videoContainer = document.getElementById('video-container');
            videoContainer.style.display = 'block';
            
            videoContainer.innerHTML = `
                <iframe 
                    width="100%" 
                    height="100%" 
                    src="https://www.youtube-nocookie.com/embed/${currentVideoId}?autoplay=1&rel=0&origin=https://www.youtube.com" 
                    title="YouTube video player" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            `;
        }

        function closeModal() {
            document.getElementById('movie-modal').classList.remove('active');
            document.body.style.overflow = 'auto'; 
            document.getElementById('video-container').innerHTML = '';
            document.getElementById('video-container').style.display = 'none';
            document.getElementById('modal-details').style.display = 'flex';
        }

        document.getElementById('movie-modal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        function createMovieCard(videoItem) {
            const snippet = videoItem.snippet;
            const videoId = snippet.resourceId.videoId;
            const originalTitle = snippet.title;
            const uiTitle = cleanTitle(originalTitle); 
            
            const thumbnails = snippet.thumbnails;
            const ytImgUrl = thumbnails?.maxres?.url || thumbnails?.standard?.url || thumbnails?.high?.url || thumbnails?.medium?.url || 'https://via.placeholder.com/280x157/222/555?text=CineTube';

            const cardWrapper = document.createElement('div'); 
            cardWrapper.className = 'movie-card-wrapper'; 
            
            cardWrapper.onclick = () => openMovieModal(videoId, uiTitle, ytImgUrl, videoItem._duration, snippet.description);

            const posterContainer = document.createElement('div');
            posterContainer.className = 'poster-container';

            const img = document.createElement('img');
            img.className = 'thumbnail';
            img.src = ytImgUrl; 
            img.alt = uiTitle;
            img.loading = "lazy"; 

            posterContainer.appendChild(img);

            if (videoItem._duration) {
                const durationOverlay = document.createElement('div');
                durationOverlay.className = 'duration-overlay';
                durationOverlay.innerText = videoItem._duration;
                posterContainer.appendChild(durationOverlay);
            }

            const infoDiv = document.createElement('div');
            infoDiv.className = 'movie-info';
            infoDiv.innerText = uiTitle; 
            infoDiv.title = uiTitle; 

            cardWrapper.appendChild(posterContainer);
            cardWrapper.appendChild(infoDiv);

            return cardWrapper;
        }

        function formatISO8601Duration(iso) {
            if (!iso) return '';
            const m = iso.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
            if (!m) return '';
            const h = parseInt(m[1] || 0, 10);
            const mm = parseInt(m[2] || 0, 10);
            const ss = parseInt(m[3] || 0, 10);
            const pad = (n) => n.toString().padStart(2, '0');
            if (h > 0) return `${h}:${pad(mm)}:${pad(ss)}`;
            return `${mm}:${pad(ss)}`;
        }

        // --- SISTEMA DE B√öSQUEDA ACTUALIZADO ---
        document.getElementById('search-bar').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase().trim();
            const rows = document.querySelectorAll('.row');
            const searchTitleEl = document.getElementById('search-results-title');

            if (searchTerm.length > 0) {
                // Activar modo b√∫squeda en todo el body
                document.body.classList.add('is-searching');
                let totalMatches = 0;

                rows.forEach(row => {
                    const cards = row.querySelectorAll('.movie-card-wrapper');
                    let hasVisibleCards = false;

                    cards.forEach(card => {
                        const title = card.querySelector('.movie-info').innerText.toLowerCase();
                        if (title.includes(searchTerm)) {
                            card.style.display = 'block'; 
                            hasVisibleCards = true;
                            totalMatches++;
                        } else {
                            card.style.display = 'none'; 
                        }
                    });

                    // Si la fila entera no tiene resultados, la ocultamos de la grilla
                    row.style.display = hasVisibleCards ? 'block' : 'none';
                });

                // Actualizar el t√≠tulo din√°mico
                if (totalMatches > 0) {
                    searchTitleEl.innerText = `Resultados para: "${e.target.value}"`;
                } else {
                    searchTitleEl.innerText = `No se encontraron resultados para: "${e.target.value}"`;
                }

            } else {
                // Restaurar vista original si la barra est√° vac√≠a
                document.body.classList.remove('is-searching');
                
                rows.forEach(row => {
                    row.style.display = 'block';
                    const cards = row.querySelectorAll('.movie-card-wrapper');
                    cards.forEach(card => {
                        card.style.display = 'block'; 
                    });
                });
            }
        });

        // Evento de scroll para el header oscuro
        window.addEventListener('scroll', () => {
            const header = document.getElementById('main-header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        initApp();
    </script>
</body>
</html>