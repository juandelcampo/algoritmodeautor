<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algoritmo de Autor</title>
    <link rel="icon" type="image/ico" href="play-3-32.ico">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&display=swap" rel="stylesheet">

    <style>
        /* --- ESTILOS GENERALES Y PALETA DE AUTOR --- */
        html { scroll-behavior: smooth; scroll-padding-top: 90px; }
        :root { 
            --bg-color: #0a0b0e; 
            --bg-surface: #14161a; 
            --text-color: #ecebe6; 
            --text-muted: #dce1eb; 
            --accent-color: #d4af37; /* Oro Cinematogr√°fico */
            
            --font-ui: 'Outfit', sans-serif;
            --font-display: 'Playfair Display', serif;
        }
        body { margin: 0; background-color: var(--bg-color); color: var(--text-color); font-family: var(--font-ui); overflow-x: hidden; }

        /* --- HEADER Y NAVEGACI√ìN --- */
        header { padding: 15px 4%; position: fixed; top: 0; width: 100%; background: linear-gradient(to bottom, rgba(10,11,14,0.95) 0%, rgba(10,11,14,0) 100%); transition: background-color 0.4s ease, backdrop-filter 0.4s ease; z-index: 1000; box-sizing: border-box; display: flex; align-items: center; gap: 30px; }
        header.scrolled { background-color: rgba(10, 11, 14, 0.90); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0,0,0,0.6); border-bottom: 1px solid rgba(255,255,255,0.03); }
        
        .logo { font-family: var(--font-display); color: var(--text-color); font-size: 2.2rem; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; text-decoration: none; flex-shrink: 0; }
        .logo span { color: var(--accent-color); font-style: italic; text-transform: lowercase; font-weight: 400; font-size: 2.4rem; margin-left: -4px;}
        
        .main-nav { display: flex; align-items: center; gap: 15px; width: 120%; overflow: visible; }

        /* --- BARRA DE B√öSQUEDA --- */
        .search-container { margin-left: auto; display: flex; align-items: center; }
        .search-input { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: var(--text-color); padding: 8px 15px; border-radius: 20px; outline: none; font-size: 0.9rem; font-family: var(--font-ui); transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); width: 110px; }
        .search-input:focus { background: rgba(0, 0, 0, 0.8); border-color: var(--accent-color); width: 125px; box-shadow: 0 0 10px rgba(212, 175, 55, 0.2);}
        .search-input::placeholder { color: rgba(236, 235, 230, 0.4); font-weight: 300;}

        /* --- DROPDOWNS (POR CLICK) --- */
        .dropdown { position: relative; display: inline-block; flex-shrink: 0; }
        .dropbtn { background: transparent; color: var(--text-color); border: 1px solid rgba(255, 255, 255, 0.15); padding: 8px 20px; border-radius: 30px; font-size: 0.95rem; font-family: var(--font-ui); font-weight: 400; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; }
        .dropbtn:hover { border-color: var(--accent-color); color: var(--accent-color); }
        .dropdown.active .dropbtn { background: var(--text-color); color: var(--bg-color); border-color: var(--text-color); }
        
        .dropdown-content { display: none; position: absolute; background-color: rgba(20, 22, 26, 0.98); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); min-width: 180px; box-shadow: 0px 15px 30px rgba(0,0,0,0.8); border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.05); top: 130%; left: 0; padding: 10px 0; z-index: 1001; }
        .dropdown.active .dropdown-content { display: block; animation: fadeIn 0.2s ease-in-out; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .dropdown-content a { color: var(--text-muted); padding: 10px 20px; text-decoration: none; display: block; font-size: 0.95rem; font-weight: 300; transition: all 0.2s; }
        .dropdown-content a:hover { background-color: rgba(255, 255, 255, 0.03); color: var(--accent-color); padding-left: 25px; border-left: 2px solid var(--accent-color); }

        /* --- P√çLDORAS DE G√âNEROS --- */
        .genres-menu { display: flex; gap: 12px; overflow-x: auto; scrollbar-width: none; -ms-overflow-style: none; padding: 5px 0; }
        .genres-menu::-webkit-scrollbar { display: none; }
        .genre-chip { color: rgba(255, 255, 255, 0.85); text-decoration: none; font-size: 0.9rem; font-weight: 500; padding: 8px 18px; border-radius: 20px; background: rgba(255, 255, 255, 0.1); white-space: nowrap; border: 1px solid transparent; transition: all 0.3s ease; }
        .genre-chip:hover { background: #fff; color: #000; border-color: #fff; transform: scale(1.05); }

        /* --- SECCI√ìN HERO FULL BLEED --- */
        .hero-wrapper { position: relative; width: 100%; height: 85vh; min-height: 500px; overflow: hidden; background-color: #000; transition: opacity 0.3s ease; border-bottom: 1px solid rgba(255,255,255,0.05);}
        
        .hero-wrapper::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0; right: 0;
            height: 25vh; 
            background: linear-gradient(to top, var(--bg-color) 0%, transparent 100%);
            z-index: 5;
            pointer-events: none;
        }

        .hero-carousel { display: flex; width: 100%; height: 100%; overflow-x: auto; overflow-y: hidden; scroll-behavior: smooth; scroll-snap-type: x mandatory; scrollbar-width: none; -ms-overflow-style: none; }
        .hero-carousel::-webkit-scrollbar { display: none; }
        
        .hero-slide { flex: 0 0 100%; height: 100%; position: relative; scroll-snap-align: start; display: flex; align-items: flex-end; padding-bottom: 8%; overflow: hidden;}
        
        .hero-video-bg { position: absolute; top: 50%; left: 50%; width: 100vw; height: 56.25vw; min-height: 100vh; min-width: 177.77vh; transform: translate(-50%, -50%); z-index: 0; pointer-events: none; border: none; opacity: 0.8;}

        .hero-cover { position: absolute; inset: 0; background-size: cover; background-position: center top; z-index: 1; transition: opacity 1.5s ease-in-out; pointer-events: none; }
        .hero-slide.video-playing .hero-cover { opacity: 0; }

        .hero-slide::before { content: ''; position: absolute; inset: 0; background: linear-gradient(to right, rgba(10,11,14,0.95) 0%, rgba(10,11,14,0.4) 50%, transparent 100%), linear-gradient(to top, rgba(10,11,14,0.8) 0%, rgba(10,11,14,0.3) 40%, transparent 100%); z-index: 2; pointer-events: none; }
        
        .hero-content { position: relative; z-index: 10; display: flex; flex-direction: column; align-items: flex-start; text-align: left; width: 100%; max-width: 800px; padding: 0 4%; }
        
        .hero-title { font-family: var(--font-display); font-size: 4rem; font-weight: 700; margin: 0 0 15px 0; line-height: 1.05; letter-spacing: 1px; text-shadow: 0 10px 30px rgba(0,0,0,0.9); color: var(--text-color); text-transform: uppercase; }
        .hero-plot { font-size: 1.15rem; font-weight: 300; color: var(--text-muted); text-shadow: 1px 1px 5px rgba(0,0,0,0.9); margin: 0 0 30px 0; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; max-width: 90%; }
        
        .info-btn { 
            display: inline-flex; align-items: center; gap: 12px; 
            background-color: rgba(236, 235, 230, 0.08); border: 1px solid rgba(236, 235, 230, 0.3);
            color: var(--text-color); padding: 12px 32px; font-size: 1.05rem; font-family: var(--font-ui); font-weight: 500; 
            border-radius: 4px; cursor: pointer; transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            backdrop-filter: blur(8px); text-transform: uppercase; letter-spacing: 1.5px;
        }
        .info-btn:hover { background-color: var(--text-color); color: var(--bg-color); transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
        
        .hero-btn { font-size: 4rem; width: 70px; background: transparent; color: rgba(255,255,255,0.3); border: none; transition: color 0.3s; z-index: 200;}
        .hero-btn:hover { color: var(--accent-color); }

        /* --- CONTENEDOR DE LISTAS --- */
        .main-content { padding-bottom: 50px; min-height: 50vh; position: relative; z-index: 10; margin-top: 30px; transition: padding-top 0.3s ease; }
        .row { margin-bottom: 50px; position: relative; }
        
        .row-title { font-family: var(--font-display); font-size: 2rem; margin-bottom: 15px; padding: 0 4%; font-weight: 400; letter-spacing: 1px; color: var(--text-color); display: flex; align-items: center; text-transform: uppercase;}
        .row-title::before { content: ''; display: inline-block; width: 3px; height: 22px; background-color: var(--accent-color); margin-right: 15px; }
        
        .row-posters { display: flex; overflow-y: visible; overflow-x: auto; padding: 20px 4%; gap: 18px; scroll-behavior: smooth; scroll-snap-type: x mandatory; scrollbar-width: none; -ms-overflow-style: none; transition: all 0.3s ease; }
        .row-posters::-webkit-scrollbar { display: none; }
        
        .scroll-btn { position: absolute; top: 50%; transform: translateY(-50%); width: 50px; height: 100%; background: linear-gradient(90deg, rgba(10,11,14,0.9) 0%, transparent 100%); border: none; color: var(--text-color); font-size: 3rem; cursor: pointer; z-index: 200; opacity: 0; transition: opacity 0.3s ease, color 0.3s ease; font-weight: 300;}
        .scroll-btn.right { right: 0; background: linear-gradient(-90deg, rgba(10,11,14,0.9) 0%, transparent 100%); }
        .row:hover .scroll-btn, .hero-wrapper:hover .scroll-btn { opacity: 0.8; }
        .scroll-btn:hover { opacity: 1 !important; color: var(--accent-color);}

        /* --- TARJETAS HORIZONTALES --- */
        .movie-card-wrapper { flex: 0 0 auto; width: 280px; text-decoration: none; cursor: pointer; transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); position: relative; z-index: 1; scroll-snap-align: start; }
        .movie-card-wrapper:hover { transform: translateY(-8px) scale(1.02); z-index: 100; transition-delay: 0s; }
        
        .poster-container { width: 100%; aspect-ratio: 16/9; position: relative; border-radius: 6px; overflow: hidden; background-color: var(--bg-surface); box-shadow: 0 6px 15px rgba(0,0,0,0.4); transition: box-shadow 0.4s ease; border: 1px solid rgba(255,255,255,0.02);}
        .movie-card-wrapper:hover .poster-container { box-shadow: 0 15px 35px rgba(0, 0, 0, 0.8); border-color: rgba(212, 175, 55, 0.3);}
        
        .thumbnail { width: 100%; height: 100%; object-fit: cover; transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .movie-card-wrapper:hover .thumbnail { transform: scale(1.08); } 
        
        .movie-info { 
            padding: 14px 4px 0 4px; 
            color: var(--text-color); 
            text-align: center; 
            font-size: 1.15rem; 
            font-weight: 500; 
            line-height: 1.3; 
            display: -webkit-box; 
            -webkit-line-clamp: 2; 
            -webkit-box-orient: vertical; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            opacity: 0.9; 
            transition: color 0.3s ease; 
            font-family: var(--font-ui); 
            letter-spacing: 0.5px;
        }
        .movie-card-wrapper:hover .movie-info { opacity: 1; color: var(--accent-color); }
        
        .duration-overlay { position: absolute; bottom: 8px; right: 8px; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); color: #fff; padding: 3px 8px; font-size: 0.75rem; border-radius: 4px; font-weight: 300; pointer-events: none; letter-spacing: 1px;}

        /* --- ESTADOS DE B√öSQUEDA --- */
        body.is-searching #hero-wrapper { display: none !important; }
        body.is-searching .main-content { padding-top: 100px; min-height: 100vh; }
        body.is-searching .row-title { display: none; } 
        body.is-searching .row { margin-bottom: 0; }
        body.is-searching .row-posters { flex-wrap: wrap; justify-content: flex-start; overflow-x: hidden; padding: 0 4% 30px 4%; gap: 25px; }
        body.is-searching .scroll-btn { display: none !important; }
        body.is-searching .movie-card-wrapper { margin-bottom: 20px; }

        #search-results-title { display: none; font-family: var(--font-display); font-size: 2.2rem; font-style: italic; margin-bottom: 30px; padding: 0 4%; font-weight: 400; color: var(--accent-color); }
        body.is-searching #search-results-title { display: block; }

        /* --- MODAL DE DETALLES DE PEL√çCULA --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(5, 6, 8, 0.9); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            z-index: 2000; display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.4s ease;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        
        .modal-content {
            background: var(--bg-surface);
            width: 90%; max-width: 900px; max-height: 90vh;
            border-radius: 12px; box-shadow: 0 25px 60px rgba(0,0,0,0.8); border: 1px solid rgba(255,255,255,0.05);
            overflow-y: auto; position: relative; padding: 45px; box-sizing: border-box;
            transform: translateY(40px); transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .modal-overlay.active .modal-content { transform: translateY(0); }

        #modal-details { display: flex; flex-direction: row; gap: 35px; width: 100%; }

        #video-container { display: none; width: 100%; aspect-ratio: 16 / 9; border-radius: 6px; overflow: hidden; background: #000; box-shadow: 0 10px 30px rgba(0,0,0,0.5);}

        .modal-close { position: absolute; top: 25px; right: 30px; background: transparent; border: none; color: var(--text-muted); font-size: 1.8rem; font-weight: 300; cursor: pointer; transition: color 0.3s; z-index: 10; font-family: var(--font-ui);}
        .modal-close:hover { color: var(--text-color); transform: scale(1.1); }

        .modal-poster { width: 32%; border-radius: 6px; box-shadow: 0 15px 35px rgba(0,0,0,0.6); object-fit: cover; aspect-ratio: 2/3; }
        
        .modal-info-text { width: 68%; display: flex; flex-direction: column; }
        .modal-title { font-family: var(--font-display); font-size: 2.8rem; margin: 0 0 10px 0; line-height: 1.1; color: var(--text-color);}
        
        .modal-meta { display: flex; gap: 15px; color: var(--accent-color); font-size: 0.95rem; font-weight: 400; margin-bottom: 25px; align-items: center; flex-wrap: wrap; letter-spacing: 1px; text-transform: uppercase;}
        .imdb-badge { border: 1px solid var(--accent-color); padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 500;}
        
        .modal-plot { font-size: 1.1rem; line-height: 1.7; color: var(--text-muted); margin-bottom: 30px; font-weight: 300;}
        
        .modal-cast { color: var(--text-muted); font-size: 0.95rem; margin-bottom: 8px; line-height: 1.5; font-weight: 300;}
        .modal-cast span { color: var(--text-color); font-weight: 400;}

        .modal-play-btn { 
            margin-top: auto; display: inline-flex; align-items: center; justify-content: center; gap: 12px; margin-top: 30px; align-self: flex-start;
            background: var(--text-color); color: var(--bg-color); padding: 14px 35px; font-size: 1.05rem; font-family: var(--font-ui); font-weight: 600; text-transform: uppercase; letter-spacing: 2px; border-radius: 4px; border: none; cursor: pointer; transition: all 0.3s ease;
        }
        .modal-play-btn:hover { background: var(--accent-color); color: #000; transform: translateY(-2px); box-shadow: 0 10px 20px rgba(212, 175, 55, 0.2); }

        /* Loading */
        .modal-loading { position: absolute; inset: 0; background: var(--bg-surface); display: flex; justify-content: center; align-items: center; z-index: 20; border-radius: 8px; }
        .loading-global { display: flex; justify-content: center; align-items: center; height: 60vh; font-size: 1.2rem; color: var(--text-muted); font-weight: 300; letter-spacing: 2px; text-transform: uppercase;}
        .spinner { border: 2px solid rgba(212, 175, 55, 0.2); border-left-color: var(--accent-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-right: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* =========================================
           MEDIA QUERIES - OPTIMIZACI√ìN M√ìVIL 
           ========================================= */
        @media (max-width: 900px) {
            header { display: none; }
            html { scroll-padding-top: 0; } 
            .scroll-btn { display: none !important; }
            .row-posters { padding-bottom: 10px; }
            .hero-wrapper { height: 75vh; min-height: 450px; }
            .hero-slide { align-items: flex-end; padding-bottom: 15%; }
            .hero-content { max-width: 100%; }
            .hero-title { font-size: 2.5rem; margin-bottom: 10px; }
            .hero-plot { font-size: 1rem; max-width: 100%; -webkit-line-clamp: 4;}
            .info-btn { padding: 10px 20px; font-size: 0.95rem; }
            .row-title { font-size: 1.8rem; }
            .main-content { margin-top: 0; } 
            
            .modal-content { padding: 30px 20px; }
            #modal-details { flex-direction: column; gap: 20px; }
            .modal-poster { width: 45%; margin: 0 auto; aspect-ratio: auto; border-radius: 4px;}
            .modal-info-text { width: 100%; align-items: center; text-align: center;}
            .modal-title { font-size: 2rem; }
            .modal-meta { justify-content: center; }
            .modal-play-btn { align-self: center; width: 100%;}
            .modal-close { top: 15px; right: 15px; background: rgba(0,0,0,0.5); width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center;}
        }
    </style>
</head>
<body>

    <header id="main-header">
        
        <nav id="main-nav" class="main-nav">
            <div id="genres-menu" class="genres-menu"></div>
            
            <div class="dropdown">
                <button class="dropbtn" onclick="toggleDropdown(this)">Colecciones <svg width="10" height="10" fill="currentColor" viewBox="0 0 16 16"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/></svg></button>
                <div class="dropdown-content" id="collections-menu"></div>
            </div>
            
            <div class="dropdown">
                <button class="dropbtn" onclick="toggleDropdown(this)">Series <svg width="10" height="10" fill="currentColor" viewBox="0 0 16 16"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/></svg></button>
                <div class="dropdown-content" id="series-menu"></div>
            </div>

            <div class="search-container">
                <input type="text" id="search-bar" class="search-input" placeholder="Buscar t√≠tulo...">
            </div>
        </nav>
    </header>

    <div class="hero-wrapper" id="hero-wrapper" style="display: none;">
        <button class="scroll-btn left hero-btn" onclick="scrollHero('left')">‚Äπ</button>
        <div id="hero-carousel" class="hero-carousel"></div>
        <button class="scroll-btn right hero-btn" onclick="scrollHero('right')">‚Ä∫</button>
    </div>

    <div class="main-content" id="app">
        <h2 id="search-results-title"></h2>
        <div class="loading-global" id="loading-global"><div class="spinner"></div> Curando cartelera...</div>
    </div>

    <div id="movie-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">‚úï</button>
            <div id="modal-loader" class="modal-loading"><div class="spinner"></div></div>
            
            <div id="video-container"></div>

            <div id="modal-details">
                <img id="modal-poster" class="modal-poster" src="" alt="Poster">
                
                <div class="modal-info-text">
                    <h2 id="modal-title" class="modal-title">T√≠tulo de la pel√≠cula</h2>
                    <div class="modal-meta">
                        <span id="modal-year">2023</span>
                        <span id="modal-runtime">120 min</span>
                        <span class="imdb-badge">IMDb <span id="modal-rating">N/A</span></span>
                    </div>
                    <p id="modal-plot" class="modal-plot">Cargando sinopsis...</p>
                    
                    <div>
                        <div class="modal-cast">Director: <span id="modal-director">-</span></div>
                        <div class="modal-cast">Elenco: <span id="modal-actors">-</span></div>
                        <div class="modal-cast">G√©nero: <span id="modal-genre-full" style="color: var(--accent-color);">-</span></div>
                        <div class="modal-cast">Pa√≠s: <span id="modal-country" style="color: var(--accent-color);">-</span></div>
                    </div>
                    
                    <button id="modal-play" class="modal-play-btn" onclick="playVideo()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                        Reproducir
                    </button>
                </div>
            </div>
        </div>
    </div>

   <script>
        const API_KEY = 'AIzaSyDuK3KF3GCPU_IHzHUOVpWHNqqBN-7lVPM'; 
        const OMDB_API_KEY = 'dd75c1c5'; 
        const MAX_VIDEOS_PER_ROW = 200; 
        const HERO_PLAYLIST_ID = "PLV7ZM4nm6CtLwkaoAb6_4SxpW9Xn6cRcM"; 

        let currentVideoId = "";
        let currentStartTime = 0;

        const categories = [
            { playlistId: "PLV7ZM4nm6CtKLpBKx3ZWIAdGHnNF6w8SS", title: "Destacadas", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtLez0TwVAwv-0ZTF9vZt6sM", title: "Drama", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtJNiGHg3OziNp7QnB7J6QOm", title: "Comedia", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtJki16toQetCi51p-CJ04Rt", title: "Acci√≥n", type: "genre" },              
            { playlistId: "PLV7ZM4nm6CtLywqlDY4bM94kFPIJr4ALz", title: "B√©lico", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtKndLGdyUOwCni78HiwFIsP", title: "Ciencia Ficci√≥n", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtJdz2iKDuiRhElws8Gy-MLf", title: "Misterio", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtJZgWKrm3b-N5IlF6OeP7hL", title: "Western", type: "genre" },          
            { playlistId: "PLV7ZM4nm6CtJMZcL-Nrmoqoobe6pztsv9", title: "Terror", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtI4dJNi59gYpi5p1aSeBwQ0", title: "Animaci√≥n", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtLTxKcOziHo-kueG1EDlLZ6", title: "Documental", type: "genre" },
            { playlistId: "PLV7ZM4nm6CtJhkRgy6oI_09l7J3zuhD0s", title: "Experimental", type: "genre" },
            
            { playlistId: "PLV7ZM4nm6CtJMglVvjnQcfR48f9jY8ioL", title: "Mariano Llin√°s", type: "collection"},
            { playlistId: "PLV7ZM4nm6CtLIIr_krlvjrL6cXt4JPViO", title: "Ra√∫l Perrone", type: "collection"},
            { playlistId: "PLV7ZM4nm6CtLuDAhLYWt9SIBj968Erm1l", title: "Leonardo Favio", type: "collection"},
            { playlistId: "PLV7ZM4nm6CtKG54-9aJYbW-N5G76oglSE", title: "Andrei Tarkovsky", type: "collection"},
            { playlistId: "PLV7ZM4nm6CtIANqEvGy04Y6ueTlo3PXk1", title: "Werner Herzog", type: "collection"},
            { playlistId: "PLV7ZM4nm6CtIwn8O37pT6RVnSfqocLoD1", title: "Ingmar Bergman", type: "collection"},
            
            { playlistId: "PLVAh-MgDVqvDUEq6qDXqORBioE4Yhol_z", title: "Fen√≥meno: The Backrooms", type: "series"}
        ];

        const appContainer = document.getElementById('app');
        const collectionsMenu = document.getElementById('collections-menu');
        const seriesMenu = document.getElementById('series-menu');
        const genresMenu = document.getElementById('genres-menu');

        function toggleDropdown(button) {
            const currentDropdown = button.parentElement;
            document.querySelectorAll('.dropdown').forEach(dropdown => {
                if (dropdown !== currentDropdown) dropdown.classList.remove('active');
            });
            currentDropdown.classList.toggle('active');
        }

        window.onclick = function(event) {
            if (!event.target.matches('.dropbtn') && !event.target.closest('.dropbtn')) {
                document.querySelectorAll('.dropdown').forEach(dropdown => dropdown.classList.remove('active'));
            }
        }

        function generateSlug(text) {
            return text.toString().toLowerCase().replace(/\s+/g, '-').replace(/[^\w\-]+/g, '').replace(/\-\-+/g, '-').replace(/^-+/, '').replace(/-+$/, '');
        }

        // NUEVA FUNCI√ìN: Extrae el a√±o original del t√≠tulo de YouTube ANTES de limpiarlo
        function extractYear(title) {
            const match = title.match(/\b(19[2-9]\d|20[0-2]\d)\b/);
            return match ? match[1] : "";
        }

        function cleanTitle(title) {
            const excepciones = {
                "el viaja al pasado y cambia el futuro (querida voy a comprar cigarros y vuelvo) 4k pel√≠ argentina": "Querida, voy a comprar cigarrillos y vuelvo",
                "la pel√≠cula argentina que predice el futuro / fase 7 [ pel√≠cula completa] con yayo": "Fase 7",
                "david lynch's - hotel room (1993) [subtitulado al espa√±ol]": "Hotel Room",
                "alfred hitchcock | the man who knew too much (1934) crime, mystery, thriller | movie, subtitles": "The Man Who Knew Too Much",
                'üìΩÔ∏è"m - eine stadt sucht einen m√∂rder".üé•fritz lang.1931/restored version/hd/deutsche-english-espa√±olüé¶': "M - Eine Stadt sucht einen M√∂rder",
                'freudian psychoanalyst art garfunkel possesses theresa russell in nicolas roegs "bad timing" 1980': "Bad Timing",
                '1989 ‚Ä¢ 2023 - the museum visitor (alternative edition)': "A Visitor to a Museum"
            };

            const tituloNormalizado = title.toLowerCase().trim();
            if (excepciones[tituloNormalizado]) { return excepciones[tituloNormalizado]; }
           
            let t = title;
            const titleLower = t.toLowerCase();
            const isSeries = titleLower.includes('backrooms') || titleLower.includes('la flor');

            if (!isSeries) {
                t = t.replace(/\(.*?\)/g, '').replace(/\[.*?\]/g, '');
                t = t.replace(/^(19|20)\d{2}\s*[-|/]+\s*/, '');
                t = t.replace(/\s+(19|20)\d{2}.*$/i, '');
            }

            const directores = [
                'Werner Herzog', 'Herzog', 'Andrei Tarkovsky', 'Tarkovsky', 'Ingmar Bergman', 'Bergman', 
                'Leonardo Favio', 'Favio', 'Mariano Llin√°s', 'Llin√°s', 'Ra√∫l Perrone', 'Perrone'
            ];
            
            directores.forEach(d => {
                const regex = new RegExp('^' + d + '\\s*[-:,|/]*\\s*', 'i');
                t = t.replace(regex, '');
            });

            if (!isSeries) {
                if (t.includes(' - ')) t = t.split(' - ')[0];
                if (t.includes(' | ')) t = t.split(' | ')[0];
                if (t.includes(' / ')) t = t.split(' / ')[0];
                if (t.includes(' // ')) t = t.split(' // ')[0];
                if (t.includes(' ‚Ä¢ ')) t = t.split(' ‚Ä¢ ')[0];
                if (t.includes(' ‚Äß ')) t = t.split(' ‚Äß ')[0];
                if (t.includes('/')) t = t.split('/')[0];
                if (t.includes('„Ää')) t = t.split('„Ää')[0];
            }

            const basura = [ 
                'pelicula completa', 'pel√≠cula completa', '1974', 'subtitulada', 'subtitulado', 'subt√≠tulos', 'Subtitulos','subtitle', 'Subtitles',
                'Brian De Palma', 'Documentary', 'criterion', 'Length', 'Watch', 'comedy', 'drama',
                '8KR REMASTER', '480p', '720p', '1080p', '4k', 'hd', 'hq', 'eng', 'dub',
                'cine', 'argentino', 'full', 'movie', 'espa√±ol', 'espanol', 'latino', 'audio', 'Pel√≠cula', '|1974',
                'oficial', 'trailer', 'cortometraje', 'documental',
                'rip', 'x264', 'x265', 'cpg', 'mkv', 'mp4', 'Blu-ray','„Äê',  'avi', 'bluray', 'persian', '‚ñ∂','brrip', 'webrip', 'dvdrip', 'hdtv', 'hevc', 'aac' 
            ];
            
            basura.forEach(palabra => { t = t.replace(new RegExp('\\b' + palabra + '\\b', 'gi'), ''); });

            const basuraExtra = ['Ra√∫l Perrone', '. Leonardo Favio. Completo', 'Leonardo Favio', 'Gory Splatter Fest of a Film', '- Uk Ep 1-3', '35Mm Scan', "Peter Jackson's", '. This Is the - Japanese Paganistic Film From', 'Jorge Nisco', 'Dir. Kim Ki-young', 'Remaster', '. John Carpenter', "de - en", "Alemania Occidental",
                                 ".de - en, ", "Freudian Psychoanalyst Art Garfunkel Possesses Theresa Russell in Nicolas Roeg's ", "by Nikos Nikolaidis ", "Fernando Ayala", "Alejandro Agresti", "N√©stor Montalbano", "Fhd", 
                                 "John Cassavetes", "Dir. Werner Herzog", "Daniel Barone", "Buster Keaton in ", "by Martin Scorsese", "Film with Subtitles", 
                                 "Leonardo Di Cesare", 'Youtube 360P', 'Juan Jos√© Jusid',  'Adolfo Aristarain', '-luis Bu√±uel', 
                                 'Juan Jos√© Campanella', 'Freudian Psychoanalyst Art Garfunkel Possesses Theresa Russell in Nicolas Roegs', 
                                 'Abbas Kiarostami Completa', 'D. Pettinari', '‚Äî1973‚Äî Wojciech Has„Äëmulti-ùó¶ùó®ùóï„Äë', 
                                 ' -Sergio Renan', 'Akira Kurosawa', 'with English','Gustavo Postiglione', 'Orson Welles‚Äô ', 
                                 'Is a Beautiful Nightmare', 'Santiago Carlos Oves', '. Koniec Cywilizacji', 'Is a Beautiful Nightmare','Film with Subtitles', 'Com√®dia', 'muy buena pelicula',  'Subtitulos en', 'Te Doy Mi Alma, Carl Jung,', 
                                 'Emilio Estevez, Samuel L Jackson, Tim Curry, William Shatner & Jon Lovitz', 'Jorge Nisco', 
                                 'by Sogo Ishii', '1 en la Isla de Berk ', 'Animated Cartoon', 'with English Subtitles', 'ÊòüÊ≤≥ÊàòÈòü1: Bd','Alejandro Jodorowsky', 
                                 '-Hollywood Action Adventure English','Pelicula argentina','Alejandro Chomski', 'Pablo Trapero', 'Il Postino: ','Esteban Sapir', 
                                 'Western', ', la', 'Alfred Hitchcock', 'Ingmar Bergman', 'de Mariano Llinas', '-- Sub.', '- Werner Herzog',
                                 'Matt Damon, Monica Bellucci In', 'Vera Fogwill', 'J. ≈†vankmajer','Israel Adri√°n Caetano', 
                                 'Burt Lancaster, Audrey Hepburn,','‚Ä¢ Rare Polish Dark Surrealism ‚Ä¢','‚Ä¢', '"', '~'];
            basuraExtra.forEach(frase => {
                t = t.replace(new RegExp(frase, 'gi'), '');
            });

            t = t.replace(/^[-|:,\.\s]+|[-|:,\.\s]+$/g, '');
            t = t.toLowerCase();
            
            const minWords = ['de', 'del', 'la', 'el', 'los', 'las', 'y', 'o', 'a', 'en', 'un', 'una', 'of', 'the', 'and', 'in', 'to', 'for', 'with', 'on', 'at', 'by'];
            t = t.split(/\s+/).map((word, index) => {
                if (!word) return '';
                const pureWord = word.replace(/[^a-z]/g, '');
                if (index === 0 || !minWords.includes(pureWord)) {
                    return word.replace(/[a-z√±√°√©√≠√≥√∫√º]/i, letter => letter.toUpperCase());
                } else {
                    return word; 
                }
            }).join(' ');

            return t.replace(/\s{2,}/g, ' ').trim();
        }

        async function translateToSpanish(text) {
            if (!text || text === "N/A") return text;
            try {
                const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=es&dt=t&q=${encodeURIComponent(text)}`;
                const response = await fetch(url);
                const data = await response.json();
                return data[0].map(item => item[0]).join('');
            } catch (error) { return text; }
        }

        async function translateToEnglish(text) {
            if (!text || text === "N/A") return text;
            try {
                const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=es&tl=en&dt=t&q=${encodeURIComponent(text)}`;
                const response = await fetch(url);
                const data = await response.json();
                return data[0].map(item => item[0]).join('');
            } catch (error) { return text; }
        }

        async function initApp() {
            if (!API_KEY || API_KEY === 'AAIzaSyDuK3KF3GCPU_IHzHUOVpWHNqqBN-7lVPM') {
                appContainer.innerHTML = '<h2 style="text-align:center; margin-top:50px; color: var(--accent-color);">‚ö†Ô∏è Falta configurar la API Key.</h2>';
                return;
            }

            try {
                await loadHeroCarousel();
                document.getElementById('loading-global').style.display = 'none';

                const rowElements = categories.map(category => {
                    const sectionId = generateSlug(category.title);
                    const shortTitle = category.title.includes(':') ? category.title.split(':')[1].trim() : category.title;

                    const navLink = document.createElement('a');
                    navLink.href = `#${sectionId}`;
                    navLink.innerText = shortTitle;

                    if (category.type === "collection") { collectionsMenu.appendChild(navLink); } 
                    else if (category.type === "series") { seriesMenu.appendChild(navLink); } 
                    else { navLink.className = 'genre-chip'; genresMenu.appendChild(navLink); }

                    return createEmptyRowStructure(category.title, sectionId);
                });

                const fetchPromises = categories.map((category, index) => {
                    return loadRowData(category.playlistId, rowElements[index]);
                });

                await Promise.all(fetchPromises);

            } catch (error) {
                console.error("Error inicializando la app:", error);
            }
        }

        // --- FETCH SINOPSIS DEL HERO (AHORA USA A√ëO COMO FILTRO) ---
        async function fetchHeroPlot(cleanUiTitle, ytDesc, elementId, movieYear) {
            const plotEl = document.getElementById(elementId);
            if (!plotEl) return;
            
            try {
                let url = `https://www.omdbapi.com/?t=${encodeURIComponent(cleanUiTitle)}&apikey=${OMDB_API_KEY}`;
                if (movieYear) url += `&y=${movieYear}`; // AGREGAMOS EL A√ëO A LA B√öSQUEDA

                let response = await fetch(url);
                let data = await response.json();
                
                // Si falla CON el a√±o, reintenta SIN el a√±o
                if (data.Response === "False" && movieYear) {
                    response = await fetch(`https://www.omdbapi.com/?t=${encodeURIComponent(cleanUiTitle)}&apikey=${OMDB_API_KEY}`);
                    data = await response.json();
                }

                if (data.Response === "False") {
                    const engTitle = await translateToEnglish(cleanUiTitle);
                    if (engTitle && engTitle.toLowerCase() !== cleanUiTitle.toLowerCase()) {
                        let engUrl = `https://www.omdbapi.com/?t=${encodeURIComponent(engTitle)}&apikey=${OMDB_API_KEY}`;
                        if (movieYear) engUrl += `&y=${movieYear}`;
                        response = await fetch(engUrl);
                        data = await response.json();
                    }
                }

                let textToTranslate = cleanYouTubeDescription(ytDesc) || "Descubre esta joya de nuestra colecci√≥n cinematogr√°fica.";
                if (data.Response === "True" && data.Plot && data.Plot !== "N/A") {
                    textToTranslate = data.Plot;
                }
                
                const finalPlot = await translateToSpanish(textToTranslate);
                plotEl.innerText = finalPlot || "Sinopsis no disponible.";
            } catch(e) {
                const fallbackPlot = await translateToSpanish(cleanYouTubeDescription(ytDesc));
                plotEl.innerText = fallbackPlot || "Descubre esta obra cinematogr√°fica destacada.";
            }
        }

        async function loadAllHeroPlotsSequential(videosArray) {
            for (let i = 0; i < videosArray.length; i++) {
                const originalTitle = videosArray[i].snippet.title;
                const uiTitle = cleanTitle(originalTitle);
                const movieYear = extractYear(originalTitle); // Extraemos el a√±o
                const desc = videosArray[i].snippet.description;
                const plotId = `hero-plot-${videosArray[i].snippet.resourceId.videoId}-${i}`;
                
                await fetchHeroPlot(uiTitle, desc, plotId, movieYear); // Pasamos el a√±o
                await new Promise(r => setTimeout(r, 600)); 
            }
        }

        async function loadHeroCarousel() {
            const videosRaw = await fetchPlaylistVideos(HERO_PLAYLIST_ID);
            const videos = videosRaw.slice(0, 6); 
            
            const carousel = document.getElementById('hero-carousel');
            const wrapper = document.getElementById('hero-wrapper');

            if (!videos || videos.length === 0) return;
            const fragment = document.createDocumentFragment();

            videos.forEach((video, index) => {
                const snippet = video.snippet;
                const originalTitle = snippet.title;
                const movieYear = extractYear(originalTitle); // Extraemos a√±o para el bot√≥n
                const uiTitle = cleanTitle(originalTitle); 
                
                const videoId = snippet.resourceId.videoId;
                const imgUrl = snippet.thumbnails?.maxres?.url || snippet.thumbnails?.standard?.url || snippet.thumbnails?.high?.url || '';

                const slide = document.createElement('div');
                slide.className = 'hero-slide';

                let startAt = (index === 0) ? 600 : 600;

                slide.innerHTML = `
                    <div class="hero-cover" style="background-image: url('${imgUrl}')"></div>
                    <iframe class="hero-video-bg" 
                        data-src="https://www.youtube-nocookie.com/embed/${videoId}?autoplay=1&mute=1&controls=0&rel=0&loop=1&playlist=${videoId}&start=${startAt}&playsinline=1" 
                        frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
                    </iframe>
                `;

                const content = document.createElement('div');
                content.className = 'hero-content';

                const titleEl = document.createElement('h1');
                titleEl.className = 'hero-title';
                titleEl.innerText = uiTitle; 

                const plotId = `hero-plot-${videoId}-${index}`;
                const plotEl = document.createElement('p');
                plotEl.className = 'hero-plot';
                plotEl.id = plotId;
                plotEl.innerText = 'Cargando rese√±a...';

                const btn = document.createElement('button');
                btn.className = 'info-btn';
                // Enviamos tambi√©n el movieYear al modal
                btn.onclick = () => openMovieModal(videoId, uiTitle, imgUrl, video._duration, snippet.description, startAt, movieYear);
                btn.innerHTML = `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg> M√°s Info`;

                content.appendChild(titleEl);
                content.appendChild(plotEl);
                content.appendChild(btn);
                slide.appendChild(content);
                fragment.appendChild(slide);
            });

            carousel.appendChild(fragment);
            wrapper.style.display = 'block';

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const iframe = entry.target.querySelector('.hero-video-bg');
                    const slide = entry.target;

                    if (iframe) {
                        if (entry.isIntersecting) {
                            if (!iframe.getAttribute('src')) {
                                iframe.onload = () => {
                                    slide.dataset.fadeTimer = setTimeout(() => {
                                        slide.classList.add('video-playing');
                                    }, 1500);
                                };
                                iframe.setAttribute('src', iframe.getAttribute('data-src'));
                            }
                        } else {
                            iframe.removeAttribute('src'); 
                            iframe.onload = null;
                            clearTimeout(slide.dataset.fadeTimer);
                            slide.classList.remove('video-playing');
                        }
                    }
                });
            }, { root: carousel, threshold: 0.5 });

            document.querySelectorAll('.hero-slide').forEach(slide => observer.observe(slide));

            loadAllHeroPlotsSequential(videos);
        }

        function scrollHero(direction) {
            const carousel = document.getElementById('hero-carousel');
            const scrollAmount = window.innerWidth;
            if (direction === 'left') { carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' }); } 
            else { carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' }); }
        }

        function createEmptyRowStructure(titleText, id) {
            const rowDiv = document.createElement('div');
            rowDiv.className = 'row';
            rowDiv.id = id; 

            const title = document.createElement('h2');
            title.className = 'row-title';
            title.innerText = titleText;

            const postersDiv = document.createElement('div');
            postersDiv.className = 'row-posters';

            const leftBtn = document.createElement('button');
            leftBtn.className = 'scroll-btn left';
            leftBtn.innerHTML = '‚Äπ';
            leftBtn.onclick = () => postersDiv.scrollBy({ left: -window.innerWidth * 0.8, behavior: 'smooth' });

            const rightBtn = document.createElement('button');
            rightBtn.className = 'scroll-btn right';
            rightBtn.innerHTML = '‚Ä∫';
            rightBtn.onclick = () => postersDiv.scrollBy({ left: window.innerWidth * 0.8, behavior: 'smooth' });

            rowDiv.appendChild(title);
            rowDiv.appendChild(leftBtn);
            rowDiv.appendChild(postersDiv);
            rowDiv.appendChild(rightBtn);
            appContainer.appendChild(rowDiv);

            return { rowDiv, postersDiv, leftBtn, rightBtn };
        }

        async function loadRowData(playlistId, elements) {
            const { rowDiv, postersDiv, leftBtn, rightBtn } = elements;
            const videos = await fetchPlaylistVideos(playlistId);

            if (videos.length === 0) { rowDiv.style.display = 'none'; return null; }
            if (videos.length < 5) { leftBtn.style.display = 'none'; rightBtn.style.display = 'none'; }

            const fragment = document.createDocumentFragment();
            videos.forEach(video => fragment.appendChild(createMovieCard(video)));
            postersDiv.appendChild(fragment);
        }

        async function fetchPlaylistVideos(playlistId) {
            try {
                let allItems = [];
                let nextPageToken = '';

                while (allItems.length < MAX_VIDEOS_PER_ROW) {
                    let url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${API_KEY}`;
                    if (nextPageToken) url += `&pageToken=${nextPageToken}`;
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (!data.items || data.items.length === 0) break;

                    const videoIds = data.items.map(it => it.snippet?.resourceId?.videoId).filter(Boolean);
                    if (videoIds.length > 0) {
                        const videosUrl = `https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${videoIds.join(',')}&key=${API_KEY}`;
                        const resp2 = await fetch(videosUrl);
                        const data2 = await resp2.json();
                        
                        const durations = {};
                        if (data2.items) {
                            data2.items.forEach(v => { durations[v.id] = v.contentDetails?.duration || ''; });
                        }

                        data.items.forEach(it => {
                            const vid = it.snippet?.resourceId?.videoId;
                            it._duration = (vid && durations[vid]) ? formatISO8601Duration(durations[vid]) : '';
                        });
                    }

                    allItems = allItems.concat(data.items);
                    nextPageToken = data.nextPageToken;
                    
                    if (!nextPageToken) break;
                }

                return allItems.slice(0, MAX_VIDEOS_PER_ROW);
            } catch (error) {
                console.error(`Error en playlist ${playlistId}:`, error);
                return [];
            }
        }

        function cleanYouTubeDescription(desc) {
            if (!desc) return "";
            let cleaned = desc.replace(/https?:\/\/[^\s]+/g, '').replace(/www\.[^\s]+/g, '');
            cleaned = cleaned.replace(/#\S+/g, '');
            cleaned = cleaned.replace(/\n+/g, ' ').replace(/\s{2,}/g, ' ').trim();
            if (cleaned.length > 250) {
                cleaned = cleaned.substring(0, 250);
                cleaned = cleaned.substring(0, Math.min(cleaned.length, cleaned.lastIndexOf(" "))) + "...";
            }
            return cleaned;
        }

        // --- OPEN MOVIE MODAL (AHORA USA A√ëO COMO FILTRO TAMBI√âN) ---
       async function openMovieModal(videoId, cleanUiTitle, ytPosterUrl, duration, ytDescription, startTime = 0, movieYear = "") {
            const modal = document.getElementById('movie-modal');
            const loader = document.getElementById('modal-loader');
            
            currentVideoId = videoId;
            currentStartTime = startTime;
            
            document.getElementById('video-container').innerHTML = '';
            document.getElementById('video-container').style.display = 'none';
            document.getElementById('modal-details').style.display = 'flex';

            document.getElementById('modal-title').innerText = cleanUiTitle; 
            document.getElementById('modal-poster').src = ytPosterUrl;
            document.getElementById('modal-plot').innerText = "Traduciendo sinopsis..."; 
            document.getElementById('modal-year').innerText = "YouTube";
            document.getElementById('modal-runtime').innerText = duration || "- min";
            document.getElementById('modal-genre-full').innerText = "Cargando..."; 
            document.getElementById('modal-country').innerText = "Cargando..."; 
            document.getElementById('modal-rating').innerText = "N/A";
            document.getElementById('modal-director').innerText = "Desconocido";
            document.getElementById('modal-actors').innerText = "Desconocido";

            modal.classList.add('active');
            loader.style.display = 'flex';
            document.body.style.overflow = 'hidden';

            const cleanYtDesc = cleanYouTubeDescription(ytDescription);

            try {
                let url = `https://www.omdbapi.com/?t=${encodeURIComponent(cleanUiTitle)}&apikey=${OMDB_API_KEY}`;
                if (movieYear) url += `&y=${movieYear}`;

                let response = await fetch(url);
                let data = await response.json();

                // Reintento sin a√±o
                if (data.Response === "False" && movieYear) {
                    response = await fetch(`https://www.omdbapi.com/?t=${encodeURIComponent(cleanUiTitle)}&apikey=${OMDB_API_KEY}`);
                    data = await response.json();
                }

                // Reintento por lista de busqueda general
                if (data.Response === "False") {
                    let sUrl = `https://www.omdbapi.com/?s=${encodeURIComponent(cleanUiTitle)}&apikey=${OMDB_API_KEY}`;
                    if (movieYear) sUrl += `&y=${movieYear}`;
                    const searchResp = await fetch(sUrl);
                    const searchData = await searchResp.json();
                    if (searchData.Response === "True" && searchData.Search.length > 0) {
                        const imdbId = searchData.Search[0].imdbID;
                        response = await fetch(`https://www.omdbapi.com/?i=${imdbId}&apikey=${OMDB_API_KEY}`);
                        data = await response.json();
                    }
                }

                // Reintento traduciendo al ingl√©s
                if (data.Response === "False") {
                    const englishTitle = await translateToEnglish(cleanUiTitle);
                    if (englishTitle.toLowerCase() !== cleanUiTitle.toLowerCase()) {
                        let engUrl = `https://www.omdbapi.com/?t=${encodeURIComponent(englishTitle)}&apikey=${OMDB_API_KEY}`;
                        if (movieYear) engUrl += `&y=${movieYear}`;
                        response = await fetch(engUrl);
                        data = await response.json();
                        
                        if (data.Response === "False") {
                            let sEngUrl = `https://www.omdbapi.com/?s=${encodeURIComponent(englishTitle)}&apikey=${OMDB_API_KEY}`;
                            if (movieYear) sEngUrl += `&y=${movieYear}`;
                            const searchRespEn = await fetch(sEngUrl);
                            const searchDataEn = await searchRespEn.json();
                            if (searchDataEn.Response === "True" && searchDataEn.Search.length > 0) {
                                const imdbIdEn = searchDataEn.Search[0].imdbID;
                                response = await fetch(`https://www.omdbapi.com/?i=${imdbIdEn}&apikey=${OMDB_API_KEY}`);
                                data = await response.json();
                            }
                        }
                    }
                }

                let textToTranslate = "Sin descripci√≥n disponible.";
                let genreToTranslate = "";
                let countryToTranslate = ""; 

                if (data.Response === "True") {
                    if(data.Poster !== "N/A") document.getElementById('modal-poster').src = data.Poster;
                    
                    document.getElementById('modal-year').innerText = data.Year;
                    document.getElementById('modal-runtime').innerText = data.Runtime;
                    document.getElementById('modal-rating').innerText = data.imdbRating;
                    document.getElementById('modal-director').innerText = data.Director;
                    document.getElementById('modal-actors').innerText = data.Actors;
                    
                    genreToTranslate = data.Genre !== "N/A" ? data.Genre : "";
                    countryToTranslate = data.Country !== "N/A" ? data.Country : "";

                    if (data.Plot && data.Plot !== "N/A") {
                        textToTranslate = data.Plot;
                    } else if (cleanYtDesc) {
                        textToTranslate = cleanYtDesc;
                    }
                } else if (cleanYtDesc) {
                    textToTranslate = cleanYtDesc;
                }

                const [finalPlot, finalGenre, finalCountry] = await Promise.all([
                    translateToSpanish(textToTranslate),
                    genreToTranslate ? translateToSpanish(genreToTranslate) : Promise.resolve(""),
                    countryToTranslate ? translateToSpanish(countryToTranslate) : Promise.resolve("")
                ]);

                document.getElementById('modal-plot').innerText = finalPlot;
                document.getElementById('modal-genre-full').innerText = finalGenre || "No disponible";
                document.getElementById('modal-country').innerText = finalCountry || "No disponible";

            } catch (error) {
                console.error("Error conectando con OMDb:", error);
                const fallbackPlot = await translateToSpanish(cleanYtDesc || "Sin descripci√≥n.");
                document.getElementById('modal-plot').innerText = fallbackPlot;
                document.getElementById('modal-genre-full').innerText = "No disponible";
                document.getElementById('modal-country').innerText = "No disponible";
            }
            
            loader.style.display = 'none';
        }

        function playVideo() {
            document.getElementById('modal-details').style.display = 'none';
            const videoContainer = document.getElementById('video-container');
            videoContainer.style.display = 'block';
            
            let startParam = currentStartTime > 0 ? `&start=${currentStartTime}` : '';

            videoContainer.innerHTML = `
                <iframe 
                    width="100%" 
                    height="100%" 
                    src="https://www.youtube-nocookie.com/embed/${currentVideoId}?autoplay=1&rel=0${startParam}&origin=https://www.youtube.com" 
                    title="YouTube video player" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            `;
        }

        function closeModal() {
            document.getElementById('movie-modal').classList.remove('active');
            document.body.style.overflow = 'auto'; 
            document.getElementById('video-container').innerHTML = '';
            document.getElementById('video-container').style.display = 'none';
            document.getElementById('modal-details').style.display = 'flex';
        }

        document.getElementById('movie-modal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        function createMovieCard(videoItem) {
            const snippet = videoItem.snippet;
            const videoId = snippet.resourceId.videoId;
            const originalTitle = snippet.title;
            const movieYear = extractYear(originalTitle); // Extraemos a√±o para las tarjetas
            const uiTitle = cleanTitle(originalTitle); 
            
            const thumbnails = snippet.thumbnails;
            const ytImgUrl = thumbnails?.maxres?.url || thumbnails?.standard?.url || thumbnails?.high?.url || thumbnails?.medium?.url || 'https://via.placeholder.com/280x157/222/555?text=CineTube';

            const cardWrapper = document.createElement('div'); 
            cardWrapper.className = 'movie-card-wrapper'; 
            
            // Le pasamos el movieYear a la funci√≥n del modal
            cardWrapper.onclick = () => openMovieModal(videoId, uiTitle, ytImgUrl, videoItem._duration, snippet.description, 0, movieYear);

            const posterContainer = document.createElement('div');
            posterContainer.className = 'poster-container';

            const img = document.createElement('img');
            img.className = 'thumbnail';
            img.src = ytImgUrl; 
            img.alt = uiTitle;
            img.loading = "lazy"; 

            posterContainer.appendChild(img);

            if (videoItem._duration) {
                const durationOverlay = document.createElement('div');
                durationOverlay.className = 'duration-overlay';
                durationOverlay.innerText = videoItem._duration;
                posterContainer.appendChild(durationOverlay);
            }

            const infoDiv = document.createElement('div');
            infoDiv.className = 'movie-info';
            infoDiv.innerText = uiTitle; 
            infoDiv.title = uiTitle; 

            cardWrapper.appendChild(posterContainer);
            cardWrapper.appendChild(infoDiv);

            return cardWrapper;
        }

        function formatISO8601Duration(iso) {
            if (!iso) return '';
            const m = iso.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
            if (!m) return '';
            const h = parseInt(m[1] || 0, 10);
            const mm = parseInt(m[2] || 0, 10);
            const ss = parseInt(m[3] || 0, 10);
            const pad = (n) => n.toString().padStart(2, '0');
            if (h > 0) return `${h}:${pad(mm)}:${pad(ss)}`;
            return `${mm}:${pad(ss)}`;
        }

        document.getElementById('search-bar').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase().trim();
            const rows = document.querySelectorAll('.row');
            const searchTitleEl = document.getElementById('search-results-title');

            if (searchTerm.length > 0) {
                document.body.classList.add('is-searching');
                let totalMatches = 0;

                rows.forEach(row => {
                    const cards = row.querySelectorAll('.movie-card-wrapper');
                    let hasVisibleCards = false;

                    cards.forEach(card => {
                        const title = card.querySelector('.movie-info').innerText.toLowerCase();
                        if (title.includes(searchTerm)) {
                            card.style.display = 'block'; 
                            hasVisibleCards = true;
                            totalMatches++;
                        } else {
                            card.style.display = 'none'; 
                        }
                    });

                    row.style.display = hasVisibleCards ? 'block' : 'none';
                });

                if (totalMatches > 0) {
                    searchTitleEl.innerText = `Resultados para: "${e.target.value}"`;
                } else {
                    searchTitleEl.innerText = `No se encontraron resultados para: "${e.target.value}"`;
                }

            } else {
                document.body.classList.remove('is-searching');
                
                rows.forEach(row => {
                    row.style.display = 'block';
                    const cards = row.querySelectorAll('.movie-card-wrapper');
                    cards.forEach(card => {
                        card.style.display = 'block'; 
                    });
                });
            }
        });

        window.addEventListener('scroll', () => {
            const header = document.getElementById('main-header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        initApp();
    </script>
</body>
</html>